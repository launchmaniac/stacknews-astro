---
// Product of Launch Maniac llc, Las Vegas, Nevada - (725) 444-8200 support@launchmaniac.com
// Static stat card component - Cyber-terminal glass panel with HUD decorators

interface Props {
  label: string;
  value: string;
  prefix?: string;
  subValue?: string;
  trend?: 'up' | 'down' | 'neutral';
  color?: string;
  valueColor?: string;
  isLive?: boolean;
  tooltip?: string;
  class?: string;
}

const {
  label,
  value,
  prefix,
  subValue,
  trend = 'neutral',
  color = '#22d3ee',
  valueColor,
  isLive = false,
  tooltip,
  class: className = ''
} = Astro.props;

// Check if wide layout
const isWide = className.includes('col-span');

// Dynamic font sizing based on value length
function getFontSize(length: number): string {
  if (length > 18) {
    if (isWide) return 'text-2xl md:text-4xl lg:text-3xl xl:text-4xl 2xl:text-5xl tracking-tighter';
    return 'text-lg md:text-xl lg:text-sm xl:text-lg 2xl:text-2xl tracking-tighter';
  }
  if (length > 14) return 'text-xl md:text-2xl lg:text-base xl:text-xl 2xl:text-3xl tracking-tight';
  if (length > 9) return 'text-2xl md:text-3xl lg:text-xl xl:text-2xl 2xl:text-3xl';
  return 'text-3xl md:text-4xl lg:text-2xl xl:text-4xl 2xl:text-5xl';
}

const fontSizeClass = getFontSize(value.length + (prefix?.length || 0));
const displayColor = valueColor || 'white';
const glowColor = valueColor || color;
---

<div
  class:list={['glass-panel glass-panel-glow p-4 rounded-xl relative overflow-hidden group flex flex-col justify-between h-full min-h-[140px] hud-corners', className]}
  style={`--panel-glow-color: ${color}20;`}
>
  <!-- Top accent line -->
  <div class="absolute top-0 left-0 right-0 h-0.5 bg-gradient-to-r from-transparent via-current to-transparent opacity-40" style={`color: ${color}`}></div>

  <!-- Background Activity Icon -->
  <div class="absolute top-2 right-2 p-2 opacity-5 group-hover:opacity-10 transition-opacity pointer-events-none">
    <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke={color} stroke-width="1">
      <polyline points="22 12 18 12 15 21 9 3 6 12 2 12" />
    </svg>
  </div>

  <div class="relative z-10 flex flex-col h-full justify-between">
    <!-- Label with Tooltip -->
    <div class="group/label relative flex items-center gap-2 mb-3 w-fit">
      <span class="w-1 h-4 rounded-full shadow-[0_0_6px_currentColor]" style={`background-color: ${color}; color: ${color}`}></span>
      <h4
        class:list={[
          'data-label text-cyan-400/90',
          tooltip && 'cursor-help border-b border-dashed border-cyan-500/30 hover:border-cyan-500/60 hover:text-cyan-300 transition-colors'
        ]}
      >
        {label}
      </h4>

      {tooltip && (
        <div class="absolute top-6 left-0 w-52 p-3 glass-panel rounded-lg shadow-2xl opacity-0 group-hover/label:opacity-100 transition-opacity duration-200 pointer-events-none z-50">
          <div class="text-[10px] leading-relaxed text-gray-300 font-sans normal-case tracking-normal">
            <span class="text-cyan-500 font-bold block mb-1 tracking-widest">// INFO</span>
            {tooltip}
          </div>
        </div>
      )}
    </div>

    <!-- Value -->
    <div
      class:list={['font-display data-value mb-1 whitespace-nowrap overflow-hidden text-ellipsis', isLive && 'tabular-nums animate-sync', fontSizeClass]}
      style={`color: ${displayColor}; text-shadow: 0 0 20px ${glowColor}40, 0 0 40px ${glowColor}20;`}
      title={prefix ? `${prefix}${value}` : value}
    >
      {prefix && <span class="text-[0.6em] opacity-50 mr-1 align-top font-mono font-normal">{prefix}</span>}
      {value}
    </div>

    <!-- Sub Value & Trend -->
    {(subValue || trend !== 'neutral') && (
      <div class="flex items-center gap-2 mt-auto pt-2 border-t border-white/5">
        {trend === 'up' && (
          <div class="flex items-center gap-1 text-red-400">
            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" class="shrink-0">
              <line x1="7" y1="17" x2="17" y2="7" />
              <polyline points="7 7 17 7 17 17" />
            </svg>
            <span class="text-[9px] font-bold tracking-wide">UP</span>
          </div>
        )}
        {trend === 'down' && (
          <div class="flex items-center gap-1 text-green-400">
            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" class="shrink-0">
              <line x1="7" y1="7" x2="17" y2="17" />
              <polyline points="17 7 17 17 7 17" />
            </svg>
            <span class="text-[9px] font-bold tracking-wide">DN</span>
          </div>
        )}
        <span class="text-gray-500 font-mono text-[10px] tracking-tight truncate">{subValue}</span>
      </div>
    )}
  </div>

  <!-- Sparkline Slot -->
  <slot />

  <!-- Ambient Glow -->
  <div class="absolute -bottom-12 -right-12 w-40 h-40 rounded-full blur-[80px] opacity-15 pointer-events-none group-hover:opacity-25 transition-opacity" style={`background-color: ${color}`}></div>
</div>
