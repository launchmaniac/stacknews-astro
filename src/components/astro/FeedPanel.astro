---
// Product of Launch Maniac llc, Las Vegas, Nevada - (725) 444-8200 support@launchmaniac.com
// Static feed panel component - Cyber-terminal aesthetic with scan-line decorators

import type { RSSItem } from '../../lib/types';
import { format, isValid } from 'date-fns';

interface Props {
  title: string;
  color?: string;
  items: RSSItem[];
  loading?: boolean;
  error?: boolean;
  class?: string;
}

const { title, color = '#22d3ee', items = [], loading = false, error = false, class: className = '' } = Astro.props;
// Do not render anything when there is no real data
if (!items || items.length === 0) {
  return null;
}

function safeDate(dateStr: string): Date {
  if (!dateStr) return new Date();
  const d = new Date(dateStr);
  return isValid(d) ? d : new Date();
}
---

<div
  class:list={['glass-panel glass-panel-glow rounded-lg flex flex-col overflow-hidden transition-all duration-300 group relative h-[400px] scan-line', className]}
  style={`--panel-glow-color: ${color}15;`}
  data-feed-panel
>
  <!-- Top accent line -->
  <div class="absolute top-0 left-0 right-0 h-0.5 bg-gradient-to-r from-transparent via-current to-transparent opacity-60" style={`color: ${color}`}></div>

  <!-- Header -->
  <div class="flex-none px-3 py-2.5 flex justify-between items-center border-b border-white/5 bg-black/30">
    <h3 class="data-label flex items-center gap-2 text-gray-200">
      <span
        class:list={['w-2 h-2 rounded-full shadow-[0_0_8px_currentColor]', loading && 'animate-pulse']}
        style={`color: ${color}; background-color: ${color}`}
      ></span>
      <span class="font-display text-sm tracking-[0.15em]" style={`color: ${color}`}>{title}</span>
    </h3>
    {items.length > 0 && (
      <div class="text-[9px] font-mono font-medium text-gray-500 tracking-wider flex items-center gap-1">
        <span class="text-cyan-500/60">[</span>
        {items.length}
        <span class="text-cyan-500/60">]</span>
        <span class="text-gray-600">ENTRIES</span>
      </div>
    )}
  </div>

  <!-- Content -->
  <div class="flex-1 overflow-hidden relative min-h-0 bg-gradient-to-b from-transparent to-black/30">
    {!error && (
      <div class="h-full overflow-y-auto scrollbar-cyber flex flex-col">
        {items.slice(0, 50).map((item, idx) => (
          <a
            href={item.link}
            target="_blank"
            rel="noopener noreferrer"
            class="flex gap-3 px-3 py-2 border-b border-white/5 hover:bg-cyan-500/5 transition-colors cursor-pointer group/item relative"
            data-feed-item
          >
            <!-- Date Column -->
            <div class="flex flex-col items-end shrink-0 w-12 pt-0.5">
              <span class="text-[10px] font-mono font-bold tracking-tighter" style={`color: ${color}`}>
                {isValid(safeDate(item.pubDate)) ? format(safeDate(item.pubDate), 'MM.dd') : '--.--'}
              </span>
              <span class="text-[9px] text-gray-600 font-mono tabular-nums">
                {isValid(safeDate(item.pubDate)) ? format(safeDate(item.pubDate), 'HH:mm') : '--:--'}
              </span>
            </div>

            <!-- Title Column -->
            <div class="flex-1 min-w-0 pr-6">
              <div class="text-[11px] font-normal text-gray-400 group-hover/item:text-cyan-100 leading-relaxed line-clamp-2 tracking-tight transition-colors">
                {item.title}
              </div>
            </div>

            <!-- External Link Icon -->
            <div class="absolute right-2 top-1/2 -translate-y-1/2 opacity-0 group-hover/item:opacity-100 transition-opacity">
              <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style={`color: ${color}`}>
                <path d="M18 13v6a2 2 0 01-2 2H5a2 2 0 01-2-2V8a2 2 0 012-2h6M15 3h6v6M10 14L21 3" />
              </svg>
            </div>

            <!-- Hover indicator line -->
            <div class="absolute left-0 top-0 bottom-0 w-0.5 opacity-0 group-hover/item:opacity-100 transition-opacity" style={`background-color: ${color}`}></div>
          </a>
        ))}

            
      </div>
    )}

        
  </div>

  <!-- Bottom fade -->
  <div class="absolute bottom-0 left-0 right-0 h-8 bg-gradient-to-t from-black/40 to-transparent pointer-events-none"></div>
</div>
